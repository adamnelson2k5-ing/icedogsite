<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Confirmation de r√©servation - ICE DOG">
    <title>Confirmation de R√©servation - ICE DOG</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #DC143C 0%, #8B0000 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 700px;
            width: 100%;
            padding: 40px;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 3px solid #DC143C;
            padding-bottom: 20px;
        }

        .logo {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .header h1 {
            color: #DC143C;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .success-badge {
            display: inline-block;
            background: #4CAF50;
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: bold;
            margin-top: 15px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .reservation-details {
            background: #F5F5F5;
            border-left: 4px solid #DC143C;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 5px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px dotted #DDD;
        }

        .detail-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .detail-label {
            font-weight: bold;
            color: #333;
        }

        .detail-value {
            color: #666;
        }

        .paiement-section {
            margin-top: 40px;
        }

        .paiement-section h2 {
            color: #DC143C;
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 2px solid #DC143C;
            padding-bottom: 15px;
        }

        .payment-methods {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .payment-card {
            border: 2px solid #DC143C;
            border-radius: 10px;
            padding: 20px;
            background: #FFF5F5;
            transition: all 0.3s ease;
        }

        .payment-card:hover {
            box-shadow: 0 5px 20px rgba(220, 20, 60, 0.2);
            transform: translateY(-5px);
        }

        .payment-card h3 {
            color: #DC143C;
            font-size: 18px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .payment-code {
            background: white;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: bold;
            color: #333;
            border-radius: 5px;
            border: 1px solid #DDD;
            word-break: break-all;
            margin: 10px 0;
        }

        .payment-card p {
            color: #555;
            line-height: 1.6;
            font-size: 14px;
        }

        .important-notice {
            background: #FFF5F5;
            border-left: 4px solid #DC143C;
            padding: 20px;
            border-radius: 5px;
            margin-top: 30px;
        }

        .important-notice h3 {
            color: #DC143C;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .important-notice p {
            color: #333;
            line-height: 1.8;
            font-size: 15px;
        }

        .important-notice strong {
            color: #DC143C;
        }

        .whatsapp-button {
            display: inline-block;
            background: #25D366;
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: bold;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .whatsapp-button:hover {
            background: #20BA5D;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.3);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: #DC143C;
            color: white;
        }

        .btn-primary:hover {
            background: #8B0000;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 20, 60, 0.3);
        }

        .btn-secondary {
            background: #FF3333;
            color: white;
        }

        .btn-secondary:hover {
            background: #CC0000;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 20, 60, 0.3);
        }

        .btn-home {
            background: #FFA500;
            color: white;
        }

        .btn-home:hover {
            background: #FF8C00;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 165, 0, 0.3);
        }

        .footer-text {
            text-align: center;
            color: #999;
            font-size: 12px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #EEE;
        }

        @media (max-width: 600px) {
            .container {
                padding: 25px;
            }

            .header h1 {
                font-size: 24px;
            }

            .detail-row {
                flex-direction: column;
                gap: 5px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<style>
    body{
        background-image: url(icc.png);
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
    }
</style>
<body>
    <div class="container">
        <!-- En-t√™te -->
        <div class="header">
            <div class="logo" id="headerLogo">üêï‚úÖ</div>
            <h1 id="headerTitle">R√©servation Confirm√©e!</h1>
            <p id="headerText">Merci pour votre confiance, votre rendez-vous a bien √©t√© enregistr√©.</p>
            <div class="success-badge">‚úì CONFIRMATION</div>
        </div>

        <!-- D√©tails de r√©servation -->
        <div class="reservation-details" id="reservationDetails">
            <div class="detail-row">
                <span class="detail-label">üë§ Nom:</span>
                <span class="detail-value" id="detailNom">-</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">üêï Chien:</span>
                <span class="detail-value" id="detailChien">-</span>
            </div>
            <div class="detail-row" id="detailDateRow">
                <span class="detail-label">üìÖ Date:</span>
                <span class="detail-value" id="detailDate">-</span>
            </div>
            <div class="detail-row" id="detailHeureRow">
                <span class="detail-label">üïê Heure:</span>
                <span class="detail-value" id="detailHeure">-</span>
            </div>
            <div class="detail-row" id="detailServiceRow">
                <span class="detail-label">üìã Type:</span>
                <span class="detail-value" id="detailService">-</span>
            </div>
            <div class="detail-row">
                <span class="detail-label">üí∞ Montant:</span>
                <span class="detail-value" id="detailMontant">-</span>
            </div>
        </div>

        <!-- Section Paiement -->
        <div class="paiement-section">
            <h2>üí≥ Modes de Paiement</h2>

            <div class="payment-methods">
                <!-- Airtel Money -->
                <div class="payment-card">
                    <h3>üì± Airtel Money</h3>
                    <div class="payment-code">074847972</div>
                    <p>Composez <strong>*150#</strong> sur votre t√©l√©phone Airtel, s√©lectionnez "Airtel Money", puis envoyez de l'argent au num√©ro ci-dessus.</p>
                </div>

                <!-- Moov Money -->
                <div class="payment-card">
                    <h3>üì± Moov Money</h3>
                    <div class="payment-code">065 77 80 10</div>
                    <p>Composez <strong>*555#</strong> sur votre t√©l√©phone Moov, s√©lectionnez "Moov Money", puis envoyez de l'argent au num√©ro ci-dessus.</p>
                </div>

                <!-- Esp√®ces -->
                <div class="payment-card">
                    <h3>üíµ Paiement en Esp√®ces</h3>
                    <p>Vous pouvez payer directement en esp√®ces lors de votre rendez-vous, apr√®s la r√©alisation du service.</p>
                </div>
            </div>

            <!-- Notice Importante -->
            <div class="important-notice">
                <h3>‚ö†Ô∏è Important</h3>
                <p>
                    Apr√®s votre paiement via <strong>Airtel Money</strong> ou <strong>Moov Money</strong>, veuillez :
                </p>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li>Prendre une <strong>capture d'√©cran</strong> de la confirmation de transaction</li>
                    <li>Envoyer la capture au <strong>05 77 80 10 via WhatsApp</strong></li>
                    <li>Inclure votre <strong>nom complet</strong> dans le message</li>
                </ol>
                <a href="https://wa.me/24105778010" target="_blank" class="whatsapp-button">
                    üí¨ Envoyer via WhatsApp
                </a>
            </div>
        </div>

        <!-- Boutons d'action -->
        <div class="action-buttons">
            <button class="btn btn-primary" onclick="telechargerFacturePDF()">üì• T√©l√©charger Facture PDF</button>
            <button class="btn btn-home" onclick="window.location.href='index.html'">üè† Retour √† l'Accueil</button>
        </div>

        <!-- Footer -->
        <div class="footer-text">
            ICE DOG - Salon de Toilettage Canin Professionnel<br>
            Libreville, Gabon | 065 77 80 10
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <script>
        // R√©cup√©rer les donn√©es de la r√©servation/abonnement depuis sessionStorage
        function loadReservationData() {
            const data = sessionStorage.getItem('reservationData');
            if (!data) {
                document.getElementById('reservationDetails').innerHTML = 
                    '<p style="color: red; padding: 20px;">Erreur: Donnees de reservation non trouvees. <a href="/">Retour a l\'accueil</a></p>';
                return;
            }

            const reservation = JSON.parse(data);
            const isSubscription = reservation.service === 'abonnement';
            
            // Adapter l'en-t√™te selon le type
            if (isSubscription) {
                document.getElementById('headerTitle').textContent = 'Abonnement Confirm√©!';
                document.getElementById('headerText').textContent = 'Merci pour votre confiance, votre abonnement mensuel a bien √©t√© enregistr√©.';
                document.getElementById('headerLogo').textContent = 'üêïüìÖ';
            }
            
            // Remplir les d√©tails
            document.getElementById('detailNom').textContent = reservation.nom || '-';
            document.getElementById('detailChien').textContent = (reservation.nomChien || '-') + ' (' + (reservation.race || '?') + ')';
            
            // Afficher la date et heure seulement pour les r√©servations
            if (!isSubscription && reservation.date) {
                const dateObj = new Date(reservation.date);
                const formatted = new Intl.DateTimeFormat('fr-FR', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                }).format(dateObj);
                document.getElementById('detailDate').textContent = formatted;
                document.getElementById('detailHeure').textContent = reservation.heure || '-';
            } else if (isSubscription) {
                // Masquer les champs de date/heure pour l'abonnement
                document.getElementById('detailDateRow').style.display = 'none';
                document.getElementById('detailHeureRow').style.display = 'none';
                document.getElementById('detailService').textContent = 'üìÖ Abonnement Mensuel';
            }
            
            // Montant selon le service
            let montant = 20000; // Standard
            let serviceText = 'Forfait Standard';
            if (isSubscription) {
                montant = 15000;
                serviceText = 'Abonnement Mensuel';
            }
            document.getElementById('detailService').textContent = serviceText;
            document.getElementById('detailMontant').textContent = montant.toLocaleString('fr-FR') + ' F CFA';
        }

        // Charger au chargement de la page
        document.addEventListener('DOMContentLoaded', loadReservationData);

        // Fonction pour generer et telecharger la facture en PDF
        function telechargerFacturePDF() {
            const btn = event && event.target ? event.target : document.querySelector(".btn-primary");
            const btnText = btn ? btn.textContent : "Telecharger Facture PDF";
            if (btn) {
                btn.textContent = "‚è≥ Generation...";
                btn.disabled = true;
            }

            const data = sessionStorage.getItem('reservationData');
            if (!data) {
                alert('Erreur: Donnees de reservation non trouvees');
                if (btn) {
                    btn.textContent = btnText;
                    btn.disabled = false;
                }
                return;
            }

            const reservation = JSON.parse(data);
            
            // Determiner le montant et le service
            let service = "Rendez-vous Standard";
            let montant = 20000;
            if (reservation.service === 'abonnement') {
                service = "Abonnement Mensuel";
                montant = 15000;
            }

            // Generer l'HTML de la facture
            const factureHTML = '<div style="font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 40px; background: white;">' +
                '<div style="border-bottom: 3px solid #DC143C; padding-bottom: 20px; text-align: center;">' +
                '<h1 style="color: #DC143C; margin: 0;">ICE DOG</h1>' +
                '<p style="margin: 5px 0; color: #666;">Salon de Toilettage Canin Professionnel</p>' +
                '<h2 style="margin: 20px 0; color: #333;">FACTURE</h2>' +
                '</div>' +
                '<div style="margin-top: 30px;">' +
                '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">' +
                '<div>' +
                '<h3 style="color: #DC143C; border-bottom: 2px solid #DC143C; padding-bottom: 10px;">CLIENT</h3>' +
                '<p><strong>Nom:</strong> ' + (reservation.nom || 'N/A').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</p>' +
                '<p><strong>Email:</strong> ' + (reservation.email || 'N/A').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</p>' +
                '<p><strong>Telephone:</strong> ' + (reservation.telephone || 'N/A').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</p>' +
                '</div>' +
                '<div>' +
                '<h3 style="color: #DC143C; border-bottom: 2px solid #DC143C; padding-bottom: 10px;">CHIEN</h3>' +
                '<p><strong>Nom:</strong> ' + (reservation.nomChien || 'N/A').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</p>' +
                '<p><strong>Race:</strong> ' + (reservation.race || 'N/A').replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</p>' +
                '<p><strong>Age / Poids:</strong> ' + (reservation.age || '?') + ' ans / ' + (reservation.poids || '?') + ' kg</p>' +
                '</div>' +
                '</div>' +
                '<div style="border-top: 2px solid #DC143C; padding-top: 20px; margin-top: 30px;">' +
                '<h3 style="color: #DC143C;">SERVICE COMMANDE</h3>' +
                '<table style="width: 100%; border-collapse: collapse; margin-top: 15px;">' +
                '<tr style="background: #DC143C; color: white;">' +
                '<th style="padding: 12px; text-align: left;">Description</th>' +
                '<th style="padding: 12px; text-align: right;">Montant</th>' +
                '</tr>' +
                '<tr>' +
                '<td style="padding: 12px; border-bottom: 1px solid #DDD;"><strong>' + service.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</strong></td>' +
                '<td style="padding: 12px; border-bottom: 1px solid #DDD; text-align: right; color: #FF3333; font-weight: bold;">' + montant.toLocaleString('fr-FR') + ' CFA</td>' +
                '</tr>' +
                '</table>' +
                '</div>' +
                '<div style="margin-top: 30px; text-align: right;">' +
                '<div style="background: #F5F5F5; border: 2px solid #DC143C; border-radius: 8px; padding: 20px; display: inline-block; min-width: 300px;">' +
                '<div style="margin-bottom: 8px;"><span style="color: #333;">Montant total:</span> <span style="font-weight: bold; color: #FF3333;">' + montant.toLocaleString('fr-FR') + ' CFA</span></div>' +
                '</div>' +
                '</div>' +
                '<div style="background: #FFF5F5; border-left: 4px solid #DC143C; padding: 15px; margin-top: 20px;">' +
                '<h4 style="color: #DC143C; margin-top: 0;">MODES DE PAIEMENT</h4>' +
                '<p style="margin: 5px 0;"><strong>Airtel Money:</strong> 074847972</p>' +
                '<p style="margin: 5px 0;"><strong>Moov Money:</strong> 065 77 80 10</p>' +
                '<p style="margin: 5px 0;"><strong>Especes:</strong> A payer apres le service</p>' +
                '</div>' +
                '</div>' +
                '</div>';

            // Creer un conteneur temporaire pour la facture
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = factureHTML;
            tempDiv.style.position = 'fixed';
            tempDiv.style.left = '-9999px';
            tempDiv.style.top = '-9999px';
            tempDiv.style.width = '900px';
            tempDiv.style.backgroundColor = 'white';
            document.body.appendChild(tempDiv);

            // Generer le PDF a partir du HTML
            setTimeout(function() {
                html2canvas(tempDiv, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: "#ffffff",
                    logging: false,
                    width: 900,
                    windowHeight: tempDiv.scrollHeight
                }).then(function(canvas) {
                    try {
                        const imgData = canvas.toDataURL("image/png");
                        const imgWidth = 210;
                        const imgHeight = (canvas.height * imgWidth) / canvas.width;
                        
                        const jsPDFModule = window.jspdf;
                        const jsPDFClass = jsPDFModule.jsPDF;
                        const pdf = new jsPDFClass("p", "mm", "a4");
                        
                        let heightLeft = imgHeight;
                        let position = 0;
                        
                        pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
                        heightLeft -= 297;
                        
                        while (heightLeft > 0) {
                            position = heightLeft - imgHeight;
                            pdf.addPage();
                            pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
                            heightLeft -= 297;
                        }
                        
                        const numeroFacture = "FAC-" + new Date().getTime();
                        pdf.save(numeroFacture + "_icedog.pdf");
                        
                        // Nettoyer
                        document.body.removeChild(tempDiv);
                        
                        if (btn) {
                            btn.textContent = btnText;
                            btn.disabled = false;
                        }
                        
                        alert("Facture telechargee avec succes!");
                    } catch (err) {
                        console.error("Erreur:", err);
                        document.body.removeChild(tempDiv);
                        if (btn) {
                            btn.textContent = btnText;
                            btn.disabled = false;
                        }
                        alert("Erreur lors de la generation du PDF.");
                    }
                }).catch(function(err) {
                    console.error("Erreur canvas:", err);
                    document.body.removeChild(tempDiv);
                    if (btn) {
                        btn.textContent = btnText;
                        btn.disabled = false;
                    }
                    alert("Erreur lors de la generation du PDF.");
                });
            }, 100);
        }
    </script>
</body>
</html>
